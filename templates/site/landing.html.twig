{% extends '/site/base_landing.html.twig' %}

{% block title %}
    {{ data.title.value }}
{% endblock %}

{% block second_col %}
    {# Form Column #}

    {# Toasts  #}
    <div class="grid grid-cols-1 gap-[5px]">
        {% for message in app.session.flashbag.get('success') %}
            {{ include('site/shared/_toast.html.twig', {toast_type: 'toast-success'}) }}
        {% endfor %}

        {# Flash error message  #}
        {% for message in app.session.flashbag.get('error') %}
            {{ include('site/shared/_toast.html.twig', {toast_type: 'toast-warning'}) }}
        {% endfor %}
    </div>

    <img class="w-[120px] h-[58px] object-scale-down mt-[75px]" src="{{ data.customerLogoName.value }}" alt="Logo"/>

    <div class="pt-[28px] leading-7">
        <p class="font-bold text-lg">Download and install an OpenRoaming profile tailored to your device, as part of the
            WBA OpenRoaming demo program.</p>
        <p class="mt-3">WBA’s profiles are proven to work across a broad range of devices, including iOS, Android,
            macOS, and Windows, ensuring optimal compatibility.</p>
    </div>

    {% if data.PLATFORM_MODE.value == constant('App\\Enum\\PlatformMode::Demo') %}
        {% if not app.user %}
            {{ form_start(registrationFormDemo) }}

            {# Email #}
            <div class="relative mt-10">
                {{ form_label(registrationFormDemo.email, null, {'label_attr': {'class': 'form-label'}}) }}
                {{ form_widget(registrationFormDemo.email, {
                    'attr': {
                        'class': 'form-widget',
                        'placeholder': 'Enter your email'
                    }
                }) }}
            </div>

            {# Turnstile Checker #}
            {% if data.TURNSTILE_CHECKER.value == constant('App\\Enum\\EmailConfirmationStrategy::EMAIL') %}
                <div class="ml-3 mt-5">
                    {{ form_widget(registrationFormDemo.security) }}
                </div>
            {% endif %}

            {# Terms Checkbox #}
            <div class="mt-[28px] flex items-center justify-start gap-2">

                {{ form_widget(registrationFormDemo.agreeTerms, {'attr': {'class': 'w-5 h-5 peer relative appearance-none
                          rounded-[5px] border border-[#CECECE] cursor-pointer checked:bg-primary'}}) }}

                <label for="{{ registrationFormDemo.agreeTerms.vars.id }}" class="text-xs">
                    I agree to the
                    <a href="{{ data.TOS_LINK.value }}" target="_blank" class="underline text-primary font-semibold">terms
                        &
                        conditions of
                        use
                    </a>
                    and
                    <a href="{{ data.PRIVACY_POLICY_LINK.value }}" target="_blank"
                       class="underline text-primary font-semibold">privacy
                        policy
                    </a>.
                </label>
            </div>

            {# OS #}
            {{ include('site/shared/_os_selection.html.twig') }}

            {# Button Submit #}
            {{ form_row(registrationFormDemo._token) }}

            {{ form_end(registrationFormDemo) }}

            {% if data.EMAIL_REGISTER_ENABLED.value or data.AUTH_METHOD_SMS_REGISTER_ENABLED.value %}
                {# Divider #}
                <div class="my-[25px] divider"></div>

                <p class="text-xs">You don't have an account? Register with

                    {% if data.EMAIL_REGISTER_ENABLED %}<a href="{{ path('app_register') }}"
                                                           class="font-semibold text-primary underline">
                            email</a>{% endif %}

                    {% if data.EMAIL_REGISTER_ENABLED and data.AUTH_METHOD_SMS_REGISTER_ENABLED %}or{% endif %}

                    {% if data.AUTH_METHOD_SMS_REGISTER_ENABLED %}<a href="{{ path('app_register_sms') }}"
                                                                     class="font-semibold text-primary underline">phone
                        number</a>.{% endif %}

                </p>
            {% endif %}

        {% else %}
            {% if data.USER_VERIFICATION.value == constant('App\\Enum\\EmailConfirmationStrategy::EMAIL') %}
                {% if not app.user.isVerified %}
                    {% include 'email_activation/index.html.twig' %}
                {% endif %}
            {% endif %}

            {% if app.request.attributes.get('_route') != 'app_email_code' %}
                <form method="post">
                    {# OS #}
                    {{ include('site/shared/_os_selection.html.twig') }}
                </form>
            {% endif %}

            <a href="{{ path('saml_logout') }}" class="w-[160px] btn-logout">Logout</a>

            {# Divider #}
            <div class="my-[25px] divider"></div>

            <div class="leading-7">
                <p>{{ data.ADDITIONAL_LABEL.value }}</p>
            </div>

            <p class="text-[#212529] text-opacity-40 text-sm">You are currently authenticated
                as {{ app.user.uuid }}
            </p>
        {% endif %}

        {# Profile selector  #}
        <div class="mt-10 w-[100%] rounded-[1px] shadow-xl bg-[#F9F9F9] px-[25px] py-[30px] text-[#212529] text-opacity-60">

            <h1 class="font-xl font-bold">DEMO MODE
                – {{ data.USER_VERIFICATION.value == constant('App\\Enum\\EmailConfirmationStrategy::NO_EMAIL') ? 'UNCONFIRMED' : 'CONFIRMED' }}
                EMAIL SYSTEM</h1>

            <p class="font-lg">This portal if for testing purposes only and should not be used in production
                environments. Users created on this portal might be revoked at anytime without notice.</p>
        </div>

    {% else %}
        {% if app.user %}
            {% if app.user.isVerified %}
                {{ include('site/shared/_os_selection.html.twig') }}
            {% else %}
                {% if data.USER_VERIFICATION.value == constant('App\\Enum\\EmailConfirmationStrategy::EMAIL') %}
                    {% include 'email_activation/index.html.twig' %}
                {% else %}
                    {{ include('site/shared/_os_selection.html.twig') }}
                {% endif %}
            {% endif %}

            <div data-controller="widget">

                <a href="{{ path('saml_logout') }}" class="w-[160px] btn-logout">Logout</a>

                <div class="flex flex-row justify-between items-center space-x-6 mt-[120px]">

                    <p class="text-[#212529] text-opacity-40 text-sm">You are currently authenticated
                        as {{ app.user.uuid }}
                    </p>

                    {% if app.user.isVerified %}
                        <div class="flex flex-row justify-end items-center gap-1">
                            <p class="text-[#707070]">Account info</p>
                            <button id="widgetUserButton" type="button" {{ stimulus_action('widget', 'open') }}
                                    class="ml-auto duration-300 cursor-pointer rounded-full text-[#707070] focus:animate-spin-slow focus:bg-[#7DB928] focus:text-white hover:shadow-lg p-2.5 relative z-0">
                                <svg class="w-6" fill="none" stroke="currentColor" stroke-width="1.5"
                                     viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.56.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round"
                                          d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                            </button>
                        </div>

                    {% endif %}
                </div>
                {% if app.user.isVerified %}

                    {# Widget User Settings #}
                    <div id="widgetUser" {{ stimulus_target('widget', 'modal') }}
                         class="hidden fixed top-0 left-0 w-full h-full bg-[#090B2F] bg-opacity-70 z-10 ">
                        <div class="flex flex-row justify-center items-center h-full w-full">
                            {{ include('admin/partials/_account_widget_landing.html.twig') }}
                        </div>
                    </div>
                {% endif %}
            </div>
        {% else %}

            {# Divider #}
            <div class="my-[25px] divider"></div>

            <div class="leading-7">
                <p class="font-bold text-lg">Obtain Your Profile:</p>
                <p>To get started, select one of the following authentication methods:</p>
            </div>

            <div class="my-[32px] 2xl:pr-[18%] grid lg:grid-cols-1 grid-cols-2 xl:grid-cols-2 gap-4">
                {% if data.SAML_ENABLED.value %}
                    <div>
                        <a href="/saml/login" class="w-full btn-primary">
                            {{ data.SAML_LABEL.value }}
                        </a>
                        <p class="text-xs mt-[8px]">{{ data.SAML_DESCRIPTION.value }}</p>
                    </div>
                {% endif %}

                {% if data.GOOGLE_LOGIN_ENABLED.value %}
                    <div>
                        <a href="{{ path('connect_google') }}" class="w-full btn-primary">
                            {{ data.GOOGLE_LOGIN_LABEL.value }}
                        </a>
                        <p class="text-xs mt-[8px]">{{ data.GOOGLE_LOGIN_DESCRIPTION.value }}</p>
                    </div>
                {% endif %}

                {% if data.EMAIL_REGISTER_ENABLED.value %}
                    <div>
                        <a href="{{ path('app_register') }}" class="w-full btn-primary">
                            {{ data.REGISTER_LABEL.value }}
                        </a>
                        <p class="text-xs mt-[8px]">{{ data.REGISTER_DESCRIPTION.value }}</p>
                    </div>
                {% endif %}

                {% if data.AUTH_METHOD_SMS_REGISTER_ENABLED.value %}
                    <div>
                        <a href="{{ path('app_register_sms') }}" class="w-full btn-primary">
                            {{ data.AUTH_METHOD_SMS_REGISTER_LABEL.value }}
                        </a>
                        <p class="text-xs mt-[8px]">{{ data.AUTH_METHOD_SMS_REGISTER_DESCRIPTION.value }}</p>
                    </div>
                {% endif %}

                {% if data.LOGIN_TRADITIONAL_ENABLED.value %}
                    <div class="w-full">
                        <a href="{{ path('app_login') }}" class="w-full h-[50px] btn-secondary">
                            {{ data.LOGIN_TRADITIONAL_LABEL.value }}
                        </a>
                        <p class="text-xs mt-[8px]">{{ data.LOGIN_TRADITIONAL_DESCRIPTION.value }}</p>
                    </div>
                {% endif %}
            </div>

            {# Divider #}
            <div class="my-[25px] divider"></div>

            <div class="leading-7">
                <p>{{ data.ADDITIONAL_LABEL.value }}</p>
            </div>
        {% endif %}
    {% endif %}

{% endblock %}
